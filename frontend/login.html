<!doctype html>
<html lang="tr" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SafeCheck - Alerji Takip</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .btn-hover {
            transition: all 0.2s ease;
        }

        .btn-hover:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .btn-hover:active {
            transform: scale(0.98);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
        }

    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full overflow-auto"></div>
  <script>
        const defaultConfig = {
            app_title: "SafeCheck",
            app_subtitle: "Akƒ±llƒ± Alerji Takip Sistemi",
            user_name: "Ahmet Yƒ±lmaz",
            user_email: "ahmet@example.com",
            background_color: "#0F172A",
            surface_color: "#1E293B",
            accent_color: "#8B5CF6",
            text_color: "#F1F5F9",
            warning_color: "#F97316",
            font_family: "Inter",
            font_size: 16
        };

        let currentPage = 'login';
        let rememberMe = false;


        function render() {
           const config = window.elementSdk?.config || defaultConfig;
           const baseFontSize = config.font_size || defaultConfig.font_size;
           const customFont = config.font_family || defaultConfig.font_family;
           const fontStack = `${customFont}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;

           const app = document.getElementById('app');
           app.innerHTML = getAuthPageContent(config, baseFontSize, fontStack);
        }




        function getAuthPageContent(config, baseFontSize, fontStack) {
            if (currentPage === 'login') {
                return `
                    <div class="w-full min-h-screen flex items-center justify-center px-6 py-12" style="background: linear-gradient(135deg, ${config.accent_color}, ${config.warning_color});">
                        <div class="w-full max-w-md">
                            <div class="rounded-3xl shadow-2xl p-10 fade-in" style="background-color: ${config.surface_color};">
                                <!-- Logo -->
                                <div class="text-center mb-8">
                                    <div style="font-size: ${baseFontSize * 4}px; margin-bottom: 16px;">üõ°Ô∏è</div>
                                    <h1 style="font-size: ${baseFontSize * 2.25}px; font-weight: 800; color: ${config.accent_color}; margin-bottom: 8px; font-family: ${fontStack};">
                                        ${config.app_title}
                                    </h1>
                                    <p style="font-size: ${baseFontSize}px; color: ${config.text_color}; opacity: 0.8; font-family: ${fontStack};">
                                        ${config.app_subtitle}
                                    </p>
                                </div>

                                <!-- Welcome Message -->
                                <div class="mb-8 text-center">
                                    <h2 style="font-size: ${baseFontSize * 1.5}px; font-weight: 700; color: ${config.text_color}; margin-bottom: 8px; font-family: ${fontStack};">
                                        Ho≈ü Geldiniz!
                                    </h2>
                                    <p style="font-size: ${baseFontSize * 0.9375}px; color: ${config.text_color}; opacity: 0.7; font-family: ${fontStack};">
                                        Hesabƒ±nƒ±za giri≈ü yapƒ±n
                                    </p>
                                </div>

                                <!-- Login Form -->
                                <form onsubmit="handleLogin(event)" class="space-y-6">
                                    <div>
                                        <label style="display: block; font-size: ${baseFontSize * 0.9375}px; font-weight: 600; color: ${config.text_color}; margin-bottom: 8px; font-family: ${fontStack};">
                                            E-posta Adresi
                                        </label>
                                        <input 
                                            type="email" 
                                            id="loginEmail"
                                            placeholder="ornek@gmail.com"
                                            required
                                            class="w-full px-5 py-4 rounded-xl shadow-lg outline-none"
                                            style="background-color: ${config.background_color}; color: ${config.text_color}; font-size: ${baseFontSize}px; font-family: ${fontStack}; border: 2px solid ${config.accent_color}40;"
                                        >
                                    </div>

                                    <div>
                                        <label style="display: block; font-size: ${baseFontSize * 0.9375}px; font-weight: 600; color: ${config.text_color}; margin-bottom: 8px; font-family: ${fontStack};">
                                            ≈ûifre
                                        </label>
                                        <input 
                                            type="password" 
                                            id="loginPassword"
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                            required
                                            class="w-full px-5 py-4 rounded-xl shadow-lg outline-none"
                                            style="background-color: ${config.background_color}; color: ${config.text_color}; font-size: ${baseFontSize}px; font-family: ${fontStack}; border: 2px solid ${config.accent_color}40;"
                                        >
                                    </div>

                                    <div class="flex items-center">
                                        <input 
                                            type="checkbox" 
                                            id="rememberMe"
                                            class="w-5 h-5 rounded"
                                            style="accent-color: ${config.accent_color};"
                                            onchange="rememberMe = this.checked"
                                        >
                                        <label for="rememberMe" style="margin-left: 12px; font-size: ${baseFontSize * 0.9375}px; color: ${config.text_color}; font-family: ${fontStack}; cursor: pointer;">
                                            Beni Hatƒ±rla
                                        </label>
                                    </div>

                                    <button 
                                        type="submit"
                                        class="w-full py-4 rounded-xl shadow-xl btn-hover"
                                        style="background: linear-gradient(135deg, ${config.accent_color}, ${config.warning_color}); color: ${config.background_color}; font-size: ${baseFontSize * 1.125}px; font-weight: 700; font-family: ${fontStack};"
                                    >
                                        Giri≈ü Yap
                                    </button>
                                </form>

                                <!-- Register Link -->
                                <div class="mt-8 text-center">
                                    <p style="font-size: ${baseFontSize * 0.9375}px; color: ${config.text_color}; opacity: 0.8; font-family: ${fontStack};">
                                        Hesabƒ±nƒ±z yok mu? 
                                        <button type="button" onclick="navigateTo('register')" style="color: ${config.accent_color}; font-weight: 700; text-decoration: underline; font-family: ${fontStack};">
                                            Hemen Kayƒ±t Olun
                                        </button>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            if (currentPage === 'register') {
                return `
                    <div class="w-full min-h-screen flex items-center justify-center px-6 py-12" style="background: linear-gradient(135deg, ${config.accent_color}, ${config.warning_color});">
                        <div class="w-full max-w-md">
                            <div class="rounded-3xl shadow-2xl p-10 fade-in" style="background-color: ${config.surface_color};">
                                <!-- Logo -->
                                <div class="text-center mb-8">
                                    <div style="font-size: ${baseFontSize * 4}px; margin-bottom: 16px;">üõ°Ô∏è</div>
                                    <h1 style="font-size: ${baseFontSize * 2.25}px; font-weight: 800; color: ${config.accent_color}; margin-bottom: 8px; font-family: ${fontStack};">
                                        ${config.app_title}
                                    </h1>
                                    <p style="font-size: ${baseFontSize}px; color: ${config.text_color}; opacity: 0.8; font-family: ${fontStack};">
                                        ${config.app_subtitle}
                                    </p>
                                </div>

                                <!-- Welcome Message -->
                                <div class="mb-8 text-center">
                                    <h2 style="font-size: ${baseFontSize * 1.5}px; font-weight: 700; color: ${config.text_color}; margin-bottom: 8px; font-family: ${fontStack};">
                                        Hesap Olu≈üturun
                                    </h2>
                                    <p style="font-size: ${baseFontSize * 0.9375}px; color: ${config.text_color}; opacity: 0.7; font-family: ${fontStack};">
                                        G√ºvenli alƒ±≈üveri≈üe ba≈ülayƒ±n
                                    </p>
                                </div>

                                <!-- Register Form -->
                                <form onsubmit="handleRegister(event)" class="space-y-5">
                                    <div>
                                        <label style="display: block; font-size: ${baseFontSize * 0.9375}px; font-weight: 600; color: ${config.text_color}; margin-bottom: 8px; font-family: ${fontStack};">
                                            Ad Soyad
                                        </label>
                                        <input 
                                            type="text" 
                                            id="registerName"
                                            placeholder="Ad Soyad"
                                            required
                                            class="w-full px-5 py-4 rounded-xl shadow-lg outline-none"
                                            style="background-color: ${config.background_color}; color: ${config.text_color}; font-size: ${baseFontSize}px; font-family: ${fontStack}; border: 2px solid ${config.accent_color}40;"
                                        >
                                    </div>

                                    <div>
                                        <label style="display: block; font-size: ${baseFontSize * 0.9375}px; font-weight: 600; color: ${config.text_color}; margin-bottom: 8px; font-family: ${fontStack};">
                                            E-posta Adresi
                                        </label>
                                        <input 
                                            type="email" 
                                            id="registerEmail"
                                            placeholder="ornek@email.com"
                                            required
                                            class="w-full px-5 py-4 rounded-xl shadow-lg outline-none"
                                            style="background-color: ${config.background_color}; color: ${config.text_color}; font-size: ${baseFontSize}px; font-family: ${fontStack}; border: 2px solid ${config.accent_color}40;"
                                        >
                                    </div>

                                    <div>
                                        <label style="display: block; font-size: ${baseFontSize * 0.9375}px; font-weight: 600; color: ${config.text_color}; margin-bottom: 8px; font-family: ${fontStack};">
                                            ≈ûifre
                                        </label>
                                        <input 
                                            type="password" 
                                            id="registerPassword"
                                            placeholder="En az 6 karakter"
                                            required
                                            minlength="6"
                                            class="w-full px-5 py-4 rounded-xl shadow-lg outline-none"
                                            style="background-color: ${config.background_color}; color: ${config.text_color}; font-size: ${baseFontSize}px; font-family: ${fontStack}; border: 2px solid ${config.accent_color}40;"
                                        >
                                    </div>

                                    <div>
                                        <label style="display: block; font-size: ${baseFontSize * 0.9375}px; font-weight: 600; color: ${config.text_color}; margin-bottom: 8px; font-family: ${fontStack};">
                                            ≈ûifre Tekrar
                                        </label>
                                        <input 
                                            type="password" 
                                            id="registerPasswordConfirm"
                                            placeholder="≈ûifrenizi tekrar girin"
                                            required
                                            minlength="6"
                                            class="w-full px-5 py-4 rounded-xl shadow-lg outline-none"
                                            style="background-color: ${config.background_color}; color: ${config.text_color}; font-size: ${baseFontSize}px; font-family: ${fontStack}; border: 2px solid ${config.accent_color}40;"
                                        >
                                    </div>

                                    <div id="passwordError" class="hidden px-4 py-3 rounded-xl" style="background-color: ${config.warning_color}20;">
                                        <p style="font-size: ${baseFontSize * 0.875}px; color: ${config.warning_color}; font-weight: 600; font-family: ${fontStack};">
                                            ‚ö†Ô∏è ≈ûifreler e≈üle≈ümiyor!
                                        </p>
                                    </div>

                                    <div class="flex items-start">
                                        <input 
                                            type="checkbox" 
                                            id="termsAccept"
                                            required
                                            class="w-5 h-5 rounded mt-1"
                                            style="accent-color: ${config.accent_color};"
                                        >
                                        <label for="termsAccept" style="margin-left: 12px; font-size: ${baseFontSize * 0.9375}px; color: ${config.text_color}; font-family: ${fontStack}; cursor: pointer;">
                                            Kullanƒ±m Ko≈üullarƒ±nƒ± kabul ediyorum
                                        </label>
                                    </div>

                                    <button 
                                        type="submit"
                                        class="w-full py-4 rounded-xl shadow-xl btn-hover"
                                        style="background: linear-gradient(135deg, ${config.accent_color}, ${config.warning_color}); color: ${config.background_color}; font-size: ${baseFontSize * 1.125}px; font-weight: 700; font-family: ${fontStack};"
                                    >
                                        Kayƒ±t Ol
                                    </button>
                                </form>

                                <!-- Login Link -->
                                <div class="mt-8 text-center">
                                    <p style="font-size: ${baseFontSize * 0.9375}px; color: ${config.text_color}; opacity: 0.8; font-family: ${fontStack};">
                                        Zaten hesabƒ±nƒ±z var mƒ±? 
                                        <button type="button" onclick="navigateTo('login')" style="color: ${config.accent_color}; font-weight: 700; text-decoration: underline; font-family: ${fontStack};">
                                            Giri≈ü Yapƒ±n
                                        </button>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }


async function handleLogin(event) {
    event.preventDefault();

    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;

    try {
        const response = await fetch("http://localhost:8080/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });

        if (!response.ok) throw new Error();

        const data = await response.json();

        console.log("LOGIN RESPONSE:", data); // üî¥ BUNU MUTLAKA G√ñRMELƒ∞Yƒ∞Z

        // ‚úÖ index.html ile UYUMLU

        localStorage.setItem("userId", data.userId);
        localStorage.setItem("token", data.token);
        localStorage.setItem("user_name", data.name);
        localStorage.setItem("user_email", data.email);


        window.location.href = "index.html";

    } catch {
        alert("E-posta veya ≈üifre hatalƒ± ‚ùå");
    }
}





async function handleRegister(event) {
    event.preventDefault();

    const name = document.getElementById("registerName").value;
    const email = document.getElementById("registerEmail").value;
    const password = document.getElementById("registerPassword").value;
    const confirm = document.getElementById("registerPasswordConfirm").value;

    if (password !== confirm) {
        document.getElementById("passwordError").classList.remove("hidden");
        return;
    }

    document.getElementById("passwordError").classList.add("hidden");

    try {
        const response = await fetch("http://localhost:8080/api/auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, password })
        });

        const text = await response.text();

        if (!response.ok) {
            throw new Error(text);
        }

        alert(text); // "Kayƒ±t ba≈üarƒ±lƒ±"
        navigateTo("login");

    } catch (err) {
        alert("‚ùå " + err.message);
        console.error(err);
    }
}






        function navigateTo(page) {
           currentPage = page;
           render();

        }




        async function onConfigChange(config) {
            render();
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            config.background_color = value;
                            window.elementSdk.setConfig({ background_color: value });
                        }
                    },
                    {
                        get: () => config.surface_color || defaultConfig.surface_color,
                        set: (value) => {
                            config.surface_color = value;
                            window.elementSdk.setConfig({ surface_color: value });
                        }
                    },
                    {
                        get: () => config.accent_color || defaultConfig.accent_color,
                        set: (value) => {
                            config.accent_color = value;
                            window.elementSdk.setConfig({ accent_color: value });
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            config.text_color = value;
                            window.elementSdk.setConfig({ text_color: value });
                        }
                    },
                    {
                        get: () => config.warning_color || defaultConfig.warning_color,
                        set: (value) => {
                            config.warning_color = value;
                            window.elementSdk.setConfig({ warning_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: {
                    get: () => config.font_family || defaultConfig.font_family,
                    set: (value) => {
                        config.font_family = value;
                        window.elementSdk.setConfig({ font_family: value });
                    }
                },
                fontSizeable: {
                    get: () => config.font_size || defaultConfig.font_size,
                    set: (value) => {
                        config.font_size = value;
                        window.elementSdk.setConfig({ font_size: value });
                    }
                }
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["app_title", config.app_title || defaultConfig.app_title],
                ["app_subtitle", config.app_subtitle || defaultConfig.app_subtitle],
                ["user_name", config.user_name || defaultConfig.user_name],
                ["user_email", config.user_email || defaultConfig.user_email]
            ]);
        }

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        render();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b273f0c0220d5ef',t:'MTc2NjQ4NjQ4NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>